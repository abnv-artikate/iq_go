{{template "layout.html" .}}

{{define "title"}}Dashboard - Cognitive Assessment{{end}}

{{define "content"}}
<div class="dashboard">
    <div class="dashboard-header">
        <h1>Welcome to CogniTest</h1>
        <p>Assess your cognitive abilities across multiple domains</p>
    </div>

    <div class="dashboard-stats">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-clipboard-check"></i>
            </div>
            <div class="stat-content">
                <h3 id="testsCompleted">0</h3>
                <p>Tests Completed</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-trophy"></i>
            </div>
            <div class="stat-content">
                <h3 id="avgScore">0%</h3>
                <p>Average Score</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
                <h3 id="avgTime">0m</h3>
                <p>Average Time</p>
            </div>
        </div>
    </div>

    <div class="dashboard-content">
        <div class="main-panel">
            <div class="test-overview">
                <h2>Cognitive Assessment Test</h2>
                <p>This comprehensive test evaluates five key cognitive domains:</p>
                
                <div class="domain-grid">
                    <div class="domain-card">
                        <i class="fas fa-puzzle-piece"></i>
                        <h4>Analytical Reasoning</h4>
                        <p>Logic, patterns, and problem-solving</p>
                    </div>
                    <div class="domain-card">
                        <i class="fas fa-memory"></i>
                        <h4>Working Memory</h4>
                        <p>Information retention and manipulation</p>
                    </div>
                    <div class="domain-card">
                        <i class="fas fa-tachometer-alt"></i>
                        <h4>Processing Speed</h4>
                        <p>Quick and accurate task completion</p>
                    </div>
                    <div class="domain-card">
                        <i class="fas fa-eye"></i>
                        <h4>Attention & Focus</h4>
                        <p>Sustained concentration abilities</p>
                    </div>
                    <div class="domain-card">
                        <i class="fas fa-heart"></i>
                        <h4>Emotional Regulation</h4>
                        <p>Managing emotions and stress</p>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <a href="/test" class="btn btn-primary btn-lg">
                        <i class="fas fa-play"></i>
                        Start New Test
                    </a>
                    <a href="/results" class="btn btn-secondary btn-lg">
                        <i class="fas fa-chart-line"></i>
                        View Results
                    </a>
                </div>
            </div>
        </div>
        
        <div class="side-panel">
            <div class="recent-results">
                <h3>Recent Results</h3>
                <div id="recentResults" class="results-list">
                    <p class="no-data">No test results yet</p>
                </div>
            </div>
        </div>
    </div>
</div>
{{end}}

{{define "scripts"}}
<script>
    // Load dashboard data
    loadDashboardData();
    
    async function loadDashboardData() {
        try {
            const response = await fetch('/api/results', {
                headers: {
                    'Authorization': `Bearer ${getToken()}`
                }
            });
            
            if (response.ok) {
                const data = await response.json();
                updateDashboardStats(data.data);
                updateRecentResults(data.data);
            }
        } catch (error) {
            console.error('Error loading dashboard data:', error);
        }
    }
    
    function updateDashboardStats(results) {
        if (!results || results.length === 0) return;
        
        document.getElementById('testsCompleted').textContent = results.length;
        
        const avgScore = results.reduce((sum, result) => {
            return sum + (result.score / result.total_questions * 100);
        }, 0) / results.length;
        document.getElementById('avgScore').textContent = Math.round(avgScore) + '%';
        
        const avgTime = results.reduce((sum, result) => sum + result.time_taken, 0) / results.length;
        document.getElementById('avgTime').textContent = Math.round(avgTime / 60) + 'm';
    }
    
    function updateRecentResults(results) {
        const container = document.getElementById('recentResults');
        
        if (!results || results.length === 0) {
            container.innerHTML = '<p class="no-data">No test results yet</p>';
            return;
        }
        
        const recentResults = results.slice(0, 5);
        container.innerHTML = recentResults.map(result => {
            const score = Math.round((result.score / result.total_questions) * 100);
            const date = new Date(result.created_at).toLocaleDateString();
            
            return `
                <div class="result-item">
                    <div class="result-score ${score >= 70 ? 'good' : score >= 50 ? 'average' : 'poor'}">
                        ${score}%
                    </div>
                    <div class="result-info">
                        <div class="result-date">${date}</div>
                        <div class="result-time">${Math.round(result.time_taken / 60)} minutes</div>
                    </div>
                </div>
            `;
        }).join('');
    }
</script>
{{end}}